{% extends 'base/base.html' %}
{% load static %}

{% block title %}AIFLIX - Watch TV Shows Online, Watch Movies Online{% endblock %}

{% block extra_css %}
<style>
    /* Genre Navigation */
    .genre-nav {
        background-color: #141414;
        padding: 15px 0;
        border-bottom: 1px solid #404040;
        position: sticky;
        top: 68px;
        z-index: 900;
    }
    
    .genre-nav .container {
        display: flex;
        overflow-x: auto;
        padding: 0 15px;
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    
    .genre-nav .container::-webkit-scrollbar {
        display: none;
    }
    
    .genre-nav .nav-item {
        flex: 0 0 auto;
        margin-right: 15px;
    }
    
    .genre-nav .nav-link {
        color: #e5e5e5;
        padding: 8px 15px;
        border-radius: 20px;
        background-color: #2a2a2a;
        white-space: nowrap;
        transition: all 0.3s;
        font-size: 0.9rem;
    }
    
    .genre-nav .nav-link:hover,
    .genre-nav .nav-link.active,
    .genre-dropdown-content a.active {
        background-color: #e50914;
        color: #ffffff;
    }
    
    /* Genre Dropdown */
    .genre-dropdown {
        position: relative;
        display: inline-block;
    }
    
    .genre-dropdown-content {
        display: none;
        position: absolute;
        background-color: #141414;
        min-width: 200px;
        box-shadow: 0 8px 16px rgba(0,0,0,0.5);
        z-index: 1;
        border-radius: 4px;
        padding: 10px 0;
        max-height: 400px;
        overflow-y: auto;
    }
    
    .genre-dropdown:hover .genre-dropdown-content {
        display: block;
    }
    
    .genre-dropdown-content a {
        color: #e5e5e5;
        padding: 8px 20px;
        text-decoration: none;
        display: block;
        transition: background-color 0.2s, color 0.2s;
        white-space: nowrap;
    }
    
    .genre-dropdown-content a:hover {
        background-color: #2a2a2a;
        color: #ffffff;
    }
    
    /* Hero Section */
    .hero-section {
        position: relative;
        height: 75vh;
        min-height: 600px;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        display: flex;
        align-items: center;
        padding: 0 4%;
        color: white;
        margin-bottom: 40px;
    }
    
    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(to top, #141414 0%, transparent 100%);
        z-index: 1;
    }
    
    .hero-content {
        position: relative;
        z-index: 2;
        max-width: 40%;
    }
    
    .hero-title {
        font-size: 3.5rem;
        font-weight: 800;
        margin-bottom: 1rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .hero-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
        font-size: 0.9rem;
        color: #b3b3b3;
    }
    
    .match {
        color: #46d369;
        font-weight: 600;
    }
    
    .maturity {
        border: 1px solid rgba(255, 255, 255, 0.4);
        padding: 0 0.4em;
        font-size: 0.9em;
    }
    
    .hero-description {
        font-size: 1.2rem;
        line-height: 1.4;
        margin-bottom: 1.5rem;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    }
    
    .hero-actions {
        display: flex;
        gap: 1rem;
    }
    
    .hero-button {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.5rem 1.5rem;
        border: none;
        border-radius: 4px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .hero-button i {
        margin-right: 8px;
    }
    
    .hero-button-primary {
        background-color: white;
        color: black;
    }
    
    .hero-button-primary:hover {
        background-color: rgba(255, 255, 255, 0.75);
    }
    
    .hero-button-secondary, .hero-button-info {
        background-color: rgba(109, 109, 110, 0.7);
        color: white;
    }
    
    .hero-button-secondary:hover, .hero-button-info:hover {
        background-color: rgba(109, 109, 110, 0.4);
    }
    
    /* Content Sections */
    .content-section {
        padding: 0 4%;
        margin-bottom: 40px;
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #e5e5e5;
        margin: 0;
    }
    
    .view-all {
        color: #e5e5e5;
        text-decoration: none;
        font-size: 0.9rem;
        transition: color 0.2s;
    }
    
    .view-all:hover {
        color: #b3b3b3;
        text-decoration: underline;
    }
    
    .content-row {
        display: flex;
        gap: 10px;
        overflow-x: auto;
        padding: 10px 0;
        scrollbar-width: none;
    }
    
    .content-row::-webkit-scrollbar {
        display: none;
    }
    
    .content-item {
        flex: 0 0 auto;
        width: 200px;
        transition: transform 0.3s ease;
    }
    
    .content-item:hover {
        transform: scale(1.05);
        z-index: 2;
    }
    
    .content-item {
        position: relative;
        border-radius: 4px;
        overflow: hidden;
        transition: transform 0.3s ease;
        aspect-ratio: 2/3;
        cursor: pointer;
    }
    
    .content-item img {
        width: 100%;
        height: 100%;
        border-radius: 4px;
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    
    .content-item:hover img {
        transform: scale(1.1);
    }
    
    .content-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        opacity: 0;
        transition: opacity 0.3s ease;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        padding: 15px;
    }
    
    .content-item:hover .content-overlay {
        opacity: 1;
    }
    
    .content-details {
        transform: translateY(20px);
        transition: transform 0.3s ease;
    }
    
    .content-item:hover .content-details {
        transform: translateY(0);
    }
    
    .content-details h3 {
        font-size: 1rem;
        margin: 0 0 5px;
        color: white;
    }
    
    .content-meta {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.8rem;
        color: #46d369;
        margin-bottom: 5px;
    }
    
    .content-meta span {
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .content-meta .maturity {
        border: 1px solid rgba(255, 255, 255, 0.4);
        padding: 0 4px;
        font-size: 0.7rem;
    }
    
    .content-genres {
        font-size: 0.8rem;
        color: #b3b3b3;
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
    }
</style>
{% endblock %}

{% block content %}
<!-- Genre Navigation -->
<nav class="genre-nav">
    <div class="container">
        <div class="genre-dropdown">
            <a href="#" class="nav-link active">
                <i class="fas fa-bars"></i> Browse All
            </a>
            <div class="genre-dropdown-content">
                <a href="{% url 'movies:home' %}" class="{% if not request.GET.genre %}active{% endif %}">All Genres</a>
                {% for genre in all_genres %}
                    <a href="?genre={{ genre.slug }}" class="{% if request.GET.genre == genre.slug %}active{% endif %}">
                        {{ genre.name }}
                    </a>
                {% endfor %}
            </div>
        </div>
        
        {% for genre in popular_genres %}
            <div class="nav-item">
                <a href="?genre={{ genre.slug }}" class="nav-link {% if request.GET.genre == genre.slug %}active{% endif %}">
                    {{ genre.name }}
                </a>
            </div>
        {% endfor %}
    </div>
</nav>

<!-- Main Content -->
<div class="content-wrapper">
    <!-- Hero Section with Featured Content -->
    {% if featured_movies|length > 0 %}
    <section class="hero-section" style="background-image: linear-gradient(to right, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 100%), url('{{ featured_movies.0.banner_image.url }}');">
        <div class="hero-content">
            <h1 class="hero-title">{{ featured_movies.0.title }}</h1>
            <div class="hero-meta">
                <span class="match">98% Match</span>
                <span class="maturity">{{ featured_movies.0.get_maturity_rating_display|default:"16+" }}</span>
                <span>{{ featured_movies.0.release_date|date:"Y" }}</span>
                {% if featured_movies.0.content_type == 'movie' %}
                    <span>{{ featured_movies.0.duration }}m</span>
                {% else %}
                    <span>{{ featured_movies.0.seasons.count }} Seasons</span>
                {% endif %}
                <span>HD</span>
            </div>
            <p class="hero-description">{{ featured_movies.0.overview|truncatechars:250 }}</p>
            <div class="hero-actions">
                <a href="{% url 'movies:watch_movie' featured_movies.0.id %}" class="hero-button hero-button-primary">
                    <i class="fas fa-play"></i> Play
                </a>
                <button class="hero-button hero-button-secondary" id="addToMyList" data-movie-id="{{ featured_movies.0.id }}">
                    <i class="fas fa-plus"></i> My List
                </button>
                <button class="hero-button hero-button-info" id="infoButton" data-movie-id="{{ featured_movies.0.id }}">
                    <i class="fas fa-info-circle"></i> Info
                </button>
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Trending Now Section -->
    <section class="content-section">
        <div class="section-header">
            <h2 class="section-title">Trending Now</h2>
            <a href="{% url 'movies:search_movies' %}?sort=trending" class="view-all">View All</a>
        </div>
        <div class="content-row trending-row">
            {% for movie in trending_movies|slice:":10" %}
            <div class="content-item">
                <a href="{% url 'movies:movie_detail' movie.id %}" class="movie-link">
                    <img src="{{ movie.poster_url }}" alt="{{ movie.title }}" class="img-fluid">
                    <div class="content-overlay">
                        <div class="content-details">
                            <h3>{{ movie.title }}</h3>
                            <div class="content-meta">
                                <span class="match">{{ movie.vote_average|floatformat:0 }}% Match</span>
                                <span class="maturity">{% if movie.adult %}+18{% else %}+13{% endif %}</span>
                                <span class="duration">{{ movie.runtime|default:"120" }}m</span>
                            </div>
                            <div class="content-genres">
                                {% for genre in movie.genres.all|slice:":3" %}
                                    <span>{{ genre.name }}</span>
                                    {% if not forloop.last %}<span>•</span>{% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Recently Added -->
    {% if recent_movies %}
    <section class="content-section">
        <div class="section-header">
            <h2 class="section-title">Recently Added</h2>
            <a href="{% url 'movies:search_movies' %}?sort=newest" class="view-all">View All</a>
        </div>
        <div class="content-row">
            {% for movie in recent_movies|slice:":10" %}
            <div class="content-item">
                <a href="{% url 'movies:movie_detail' movie.id %}" class="movie-link">
                    <img src="{{ movie.poster_url|default:movie.thumbnail.url }}" alt="{{ movie.title }}" class="img-fluid">
                    <div class="content-overlay">
                        <div class="content-details">
                            <h3>{{ movie.title }}</h3>
                            <div class="content-meta">
                                <span class="match">{{ movie.vote_average|floatformat:0 }}% Match</span>
                                <span class="maturity">{% if movie.adult %}+18{% else %}+13{% endif %}</span>
                                <span class="duration">{{ movie.duration|default:120 }}m</span>
                            </div>
                            <div class="content-genres">
                                {% for genre in movie.genres.all|slice:":3" %}
                                    <span>{{ genre.name }}</span>
                                    {% if not forloop.last %}<span>•</span>{% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Movies -->
    {% if movies %}
    <section class="content-section">
        <div class="section-header">
            <h2 class="section-title">Movies</h2>
            <a href="{% url 'movies:search_movies' %}?type=movie" class="view-all">View All</a>
        </div>
        <div class="content-row">
            {% for movie in movies|slice:":10" %}
            <div class="content-item">
                <a href="{% url 'movies:movie_detail' movie.id %}" class="movie-link">
                    <img src="{{ movie.poster_url|default:movie.thumbnail.url }}" alt="{{ movie.title }}" class="img-fluid">
                    <div class="content-overlay">
                        <div class="content-details">
                            <h3>{{ movie.title }}</h3>
                            <div class="content-meta">
                                <span class="match">{{ movie.vote_average|floatformat:0 }}% Match</span>
                                <span class="maturity">{% if movie.adult %}+18{% else %}+13{% endif %}</span>
                                <span class="duration">{{ movie.duration|default:120 }}m</span>
                            </div>
                            <div class="content-genres">
                                {% for genre in movie.genres.all|slice:":3" %}
                                    <span>{{ genre.name }}</span>
                                    {% if not forloop.last %}<span>•</span>{% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>

<!-- Footer -->
<footer class="footer">
    <div class="container">
        <div class="footer-links">
            <div class="footer-links-column">
                <h3>Audio and Subtitles</h3>
                <ul>
                    <li><a href="#">Media Center</a></li>
                    <li><a href="#">Privacy</a></li>
                    <li><a href="#">Contact Us</a></li>
                </ul>
            </div>
            <div class="footer-links-column">
                <h3>Help Center</h3>
                <ul>
                    <li><a href="#">Jobs</a></li>
                    <li><a href="#">Cookie Preferences</a></li>
                </ul>
            </div>
            <div class="footer-links-column">
                <h3>Gift Cards</h3>
                <ul>
                    <li><a href="#">Terms of Use</a></li>
                    <li><a href="#">Corporate Information</a></li>
                </ul>
            </div>
            <div class="footer-links-column">
                <h3>Media Center</h3>
                <ul>
                    <li><a href="#">Legal Notices</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2025 AIFLIX</p>
            <div>
                <a href="#">Privacy</a>
                <a href="#">Terms of Use</a>
                <a href="#">Help</a>
            </div>
        </div>
    </div>
</footer>

{% endblock %}

{% block extra_js %}
<script>
// Add to My List functionality
document.addEventListener('DOMContentLoaded', function() {
    const addToMyListBtn = document.getElementById('addToMyList');
    
    if (addToMyListBtn) {
        addToMyListBtn.addEventListener('click', function() {
            const movieId = this.dataset.movieId;
            const url = `/profiles/toggle-my-list/${movieId}/`;
            
            fetch(url, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'X-Requested-With': 'XMLHttpRequest',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'added') {
                    this.innerHTML = '<i class="fas fa-check"></i> My List';
                    this.classList.add('btn-success');
                    this.classList.remove('btn-outline-light');
                } else if (data.status === 'removed') {
                    this.innerHTML = '<i class="far fa-plus"></i> My List';
                    this.classList.remove('btn-success');
                    this.classList.add('btn-outline-light');
                }
                
                // Show a toast notification
                const toast = new bootstrap.Toast(document.getElementById('toast'));
                document.getElementById('toast-message').textContent = data.message;
                toast.show();
            })
            .catch(error => console.error('Error:', error));
        });
    }

    // Navbar scroll effect
    window.addEventListener('scroll', function() {
        const navbar = document.querySelector('.navbar');
        if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });

    // Handle play button clicks
    document.querySelectorAll('.play-button').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const movieId = this.getAttribute('data-movie-id');
            window.location.href = `/movies/watch/${movieId}/`;
        });
    });
});
</script>
{% endblock %}
